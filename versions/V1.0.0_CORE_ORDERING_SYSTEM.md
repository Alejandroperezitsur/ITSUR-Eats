# ğŸ”– v1.0.0 â€” Core Ordering System

**Fecha de Lanzamiento Objetivo**: Mes 2
**DuraciÃ³n del Sprint**: 8 semanas
**Estado**: EspecificaciÃ³n Final

---

## ğŸ¯ Objetivo de la VersiÃ³n

Establecer la funcionalidad base del sistema de pedidos con autenticaciÃ³n institucional, catÃ¡logo de productos y gestiÃ³n bÃ¡sica de pedidos. Este MVP permite a estudiantes y profesores realizar su primer pedido mientras que administradores monitorean operaciones desde una consola web simple.

### Problemas Resueltos
- âŒ Filas largas en cafeterÃ­a â†’ âœ… Pedidos por app
- âŒ Inventario desconocido â†’ âœ… Disponibilidad en tiempo real
- âŒ Cero trazabilidad â†’ âœ… Historial de pedidos
- âŒ Sin validaciÃ³n de usuarios â†’ âœ… AutenticaciÃ³n institucional

### Habilita
- Baseline de engagement de usuarios
- Primeros datos de comportamiento
- OperaciÃ³n bÃ¡sica de cafeterÃ­a
- ValidaciÃ³n del concepto

---

## ğŸ§© Funcionalidades Incluidas

### App Estudiante/Profesor (Mobile)

#### Authentication
- âœ… Registro con correo institucional (@itsur.edu.mx)
- âœ… ValidaciÃ³n de cÃ³digo institucional
- âœ… VerificaciÃ³n de correo con OTP (One-Time Password)
- âœ… Login con JWT
- âœ… Remember me (por 30 dÃ­as)
- âœ… Logout y session management

**Pantalla de Registro:**
```
1. Email @itsur.edu.mx
2. Carrera/Departamento (selectable)
3. NÃºmero de control
4. Nombre completo
5. ContraseÃ±a (mÃ­n. 8 caracteres, mayÃºsculas, nÃºmeros)
6. CÃ³digo OTP de confirmaciÃ³n
```

#### Perfil
- âœ… Ver datos personales
- âœ… Editar foto de perfil
- âœ… Cambiar contraseÃ±a
- âœ… Ver nÃºmero de telÃ©fono (opcional)
- âœ… Cambiar preferencias de notificaciones
- âœ… Logout

#### MenÃº (CatÃ¡logo)
- âœ… Ver todas las categorÃ­as
- âœ… Filtrar por categorÃ­a
- âœ… Ver detalles del producto (foto, descripciÃ³n, precio)
- âœ… Ver disponibilidad en tiempo real
- âœ… BÃºsqueda por nombre de producto
- âœ… Historial de Ãºltimas compras

#### Hacer Pedido
- âœ… Carrito visual con cantidad
- âœ… Calcular subtotal automÃ¡ticamente
- âœ… Seleccionar ubicaciÃ³n de entrega (salones predefinidos)
- âœ… Agregar notas especiales ("Sin picante", etc.)
- âœ… Resumen de pedido antes de confirmar
- âœ… BotÃ³n "Confirmar Pedido"

**Estados de Pedido (Usuario ve)**
- ğŸ”´ En espera (Pending)
- ğŸŸ¡ Aceptado (Accepted)
- ğŸŸ  En preparaciÃ³n (Preparing)
- ğŸŸ¢ Listo para recoger (Ready)
- âš« Cancelado (Cancelled)

#### Historial de Pedidos
- âœ… Lista de todos los pedidos realizados
- âœ… Ordenado por fecha descendente
- âœ… Ver detalles de cada pedido
- âœ… Repetir pedido anterior (quick-order)
- âœ… Ver estado histÃ³rico del pedido

#### Notificaciones Push (BÃ¡sicas en v1)
- âœ… Pedido aceptado
- âœ… Pedido listo para recoger
- âœ… Pedido cancelado

---

### Panel CafeterÃ­a/Admin (Web)

#### Dashboard BÃ¡sico
- âœ… Total de pedidos hoy
- âœ… Ingresos del dÃ­a
- âœ… Pedidos en tiempo real (tabla actualizable)
- âœ… Estado general del sistema (uptime)

#### GestiÃ³n de Pedidos
- âœ… Ver todos los pedidos (ordenados por tiempo)
- âœ… Filtrar por estado
- âœ… Aceptar pedido (1 clic)
- âœ… Marcar como "En preparaciÃ³n"
- âœ… Marcar como "Listo"
- âœ… Rechazar pedido con motivo
- âœ… Ver detalles completos (cliente, productos, notas)

#### GestiÃ³n de Productos
- âœ… Crear nuevo producto (nombre, descripciÃ³n, precio, categorÃ­a, foto)
- âœ… Editar producto
- âœ… Eliminar producto (soft delete)
- âœ… Actualizar disponibilidad (SÃ­/No)
- âœ… Actualizar cantidad en stock
- âœ… Ver lista de productos por categorÃ­a

#### GestiÃ³n de CategorÃ­as
- âœ… Ver todas las categorÃ­as
- âœ… Crear nueva categorÃ­a
- âœ… Editar nombre y orden de visualizaciÃ³n
- âœ… Habilitar/deshabilitar categorÃ­a

#### GestiÃ³n de Usuarios (BÃ¡sica)
- âœ… Ver lista de todos los usuarios
- âœ… Filtrar por rol (Estudiante/Profesor/Admin)
- âœ… Ver detalles del usuario
- âœ… Desactivar usuario (no eliminar)
- âœ… Buscar usuario por email/cÃ³digo institucional

#### Reportes BÃ¡sicos
- âœ… Resumen de ventas del dÃ­a
- âœ… Productos mÃ¡s vendidos
- âœ… Horarios pico de pedidos

---

### Sistema (Backend)

#### AutenticaciÃ³n & AutorizaciÃ³n
- âœ… JWT con refresh token
- âœ… ValidaciÃ³n de @itsur.edu.mx
- âœ… VerificaciÃ³n de cÃ³digo institucional contra base de datos
- âœ… Roles: STUDENT, PROFESSOR, ADMIN
- âœ… Guards de autorizaciÃ³n por endpoint
- âœ… Rate limiting (100 requests/minuto por IP)

#### API Endpoints

**Auth:**
```
POST   /api/auth/register         - Registro de usuario
POST   /api/auth/verify-otp       - Verificar OTP
POST   /api/auth/login            - Iniciar sesiÃ³n
POST   /api/auth/refresh-token    - Renovar JWT
POST   /api/auth/logout           - Cerrar sesiÃ³n
POST   /api/auth/forgot-password  - Recuperar contraseÃ±a
```

**Users:**
```
GET    /api/users/profile         - Obtener perfil actual
PUT    /api/users/profile         - Actualizar perfil
PUT    /api/users/password        - Cambiar contraseÃ±a
GET    /api/users/admin/all       - Listar usuarios (admin)
PUT    /api/users/admin/:id       - Actualizar usuario (admin)
DELETE /api/users/admin/:id       - Desactivar usuario (admin)
```

**Products:**
```
GET    /api/products              - Obtener todos los productos
GET    /api/products/:id          - Obtener producto especÃ­fico
GET    /api/categories            - Obtener categorÃ­as
POST   /api/products (admin)      - Crear producto
PUT    /api/products/:id (admin)  - Actualizar producto
DELETE /api/products/:id (admin)  - Eliminar producto
```

**Orders:**
```
POST   /api/orders                - Crear pedido
GET    /api/orders                - Ver mis pedidos
GET    /api/orders/:id            - Ver detalles del pedido
PUT    /api/orders/:id/cancel     - Cancelar pedido
GET    /api/orders/admin/all      - Ver todos los pedidos (admin)
PUT    /api/orders/:id/status     - Cambiar estado del pedido (admin)
PUT    /api/orders/:id/reject     - Rechazar pedido (admin)
```

**Admin:**
```
GET    /api/admin/dashboard       - Datos del dashboard
GET    /api/admin/stats/daily     - EstadÃ­sticas del dÃ­a
```

---

## ğŸ—ï¸ Arquitectura TÃ©cnica

### Frontend MÃ³vil (React Native + Expo)

**Estructura de carpetas:**
```
mobile/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterScreen.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ VerifyOTPScreen.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginScreen.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RecoverPasswordScreen.tsx
â”‚   â”‚   â”œâ”€â”€ menu/
â”‚   â”‚   â”‚   â”œâ”€â”€ MenuScreen.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductDetailScreen.tsx
â”‚   â”‚   â”‚   â””â”€â”€ CategoryFilterScreen.tsx
â”‚   â”‚   â”œâ”€â”€ order/
â”‚   â”‚   â”‚   â”œâ”€â”€ CartScreen.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CheckoutScreen.tsx
â”‚   â”‚   â”‚   â””â”€â”€ OrderConfirmationScreen.tsx
â”‚   â”‚   â”œâ”€â”€ history/
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderHistoryScreen.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderDetailScreen.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RepeatOrderScreen.tsx
â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”œâ”€â”€ ProfileScreen.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EditProfileScreen.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PreferencesScreen.tsx
â”‚   â”‚   â””â”€â”€ tracking/
â”‚   â”‚       â””â”€â”€ OrderTrackingScreen.tsx
â”‚   â”œâ”€â”€ navigation/
â”‚   â”‚   â”œâ”€â”€ RootNavigator.tsx
â”‚   â”‚   â”œâ”€â”€ AuthNavigator.tsx
â”‚   â”‚   â””â”€â”€ AppNavigator.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ LoadingSpinner.tsx
â”‚   â”‚   â””â”€â”€ specific/
â”‚   â”‚       â”œâ”€â”€ OrderStatus.tsx
â”‚   â”‚       â””â”€â”€ CartSummary.tsx
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”œâ”€â”€ authSlice.ts
â”‚   â”‚   â”œâ”€â”€ orderSlice.ts
â”‚   â”‚   â”œâ”€â”€ menuSlice.ts
â”‚   â”‚   â””â”€â”€ store.ts
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ order.service.ts
â”‚   â”‚   â”œâ”€â”€ product.service.ts
â”‚   â”‚   â””â”€â”€ notification.service.ts
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useOrder.ts
â”‚   â”‚   â”œâ”€â”€ useFetch.ts
â”‚   â”‚   â””â”€â”€ useNotification.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ user.types.ts
â”‚   â”‚   â”œâ”€â”€ order.types.ts
â”‚   â”‚   â”œâ”€â”€ product.types.ts
â”‚   â”‚   â””â”€â”€ api.types.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ constants.ts
â”‚   â”‚   â”œâ”€â”€ validation.ts
â”‚   â”‚   â”œâ”€â”€ formatters.ts
â”‚   â”‚   â””â”€â”€ storage.ts
â”‚   â”œâ”€â”€ theme/
â”‚   â”‚   â”œâ”€â”€ colors.ts
â”‚   â”‚   â”œâ”€â”€ typography.ts
â”‚   â”‚   â””â”€â”€ spacing.ts
â”‚   â””â”€â”€ App.tsx
â”œâ”€â”€ app.json
â”œâ”€â”€ eas.json
â””â”€â”€ package.json
```

**Dependencies:**
```json
{
  "react-native": "0.73.0",
  "expo": "^50.0.0",
  "@react-navigation/native": "^6.1.0",
  "@react-navigation/bottom-tabs": "^6.5.0",
  "@react-navigation/stack": "^6.3.0",
  "@reduxjs/toolkit": "^1.9.7",
  "react-redux": "^8.1.3",
  "axios": "^1.6.2",
  "react-native-paper": "^5.11.0",
  "react-native-safe-area-context": "^4.8.0",
  "expo-secure-store": "^13.0.0",
  "react-native-keychain": "^9.0.1",
  "@react-native-camera-roll/camera-roll": "^5.8.0",
  "react-hook-form": "^7.48.0"
}
```

### Backend (NestJS)

**Estructura de carpetas:**
```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”œâ”€â”€ strategies/
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.strategy.ts
â”‚   â”‚   â”‚   â””â”€â”€ jwt-refresh.strategy.ts
â”‚   â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt-auth.guard.ts
â”‚   â”‚   â”‚   â””â”€â”€ roles.guard.ts
â”‚   â”‚   â”œâ”€â”€ decorators/
â”‚   â”‚   â”‚   â”œâ”€â”€ current-user.decorator.ts
â”‚   â”‚   â”‚   â””â”€â”€ roles.decorator.ts
â”‚   â”‚   â”œâ”€â”€ dtos/
â”‚   â”‚   â”‚   â”œâ”€â”€ register.dto.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ login.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ verify-otp.dto.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ user.entity.ts
â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â”œâ”€â”€ users.service.ts
â”‚   â”‚   â”œâ”€â”€ users.module.ts
â”‚   â”‚   â”œâ”€â”€ dtos/
â”‚   â”‚   â”‚   â”œâ”€â”€ update-profile.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ change-password.dto.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ user.entity.ts
â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â”œâ”€â”€ products.controller.ts
â”‚   â”‚   â”œâ”€â”€ products.service.ts
â”‚   â”‚   â”œâ”€â”€ products.module.ts
â”‚   â”‚   â”œâ”€â”€ dtos/
â”‚   â”‚   â”‚   â”œâ”€â”€ create-product.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ update-product.dto.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â”œâ”€â”€ product.entity.ts
â”‚   â”‚       â””â”€â”€ category.entity.ts
â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â”œâ”€â”€ orders.controller.ts
â”‚   â”‚   â”œâ”€â”€ orders.service.ts
â”‚   â”‚   â”œâ”€â”€ orders.module.ts
â”‚   â”‚   â”œâ”€â”€ dtos/
â”‚   â”‚   â”‚   â”œâ”€â”€ create-order.dto.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ update-order-status.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ reject-order.dto.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â”œâ”€â”€ order.entity.ts
â”‚   â”‚       â””â”€â”€ order-item.entity.ts
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ admin.controller.ts
â”‚   â”‚   â”œâ”€â”€ admin.service.ts
â”‚   â”‚   â””â”€â”€ admin.module.ts
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ filters/
â”‚   â”‚   â”‚   â””â”€â”€ http-exception.filter.ts
â”‚   â”‚   â”œâ”€â”€ interceptors/
â”‚   â”‚   â”‚   â””â”€â”€ logging.interceptor.ts
â”‚   â”‚   â”œâ”€â”€ decorators/
â”‚   â”‚   â”‚   â””â”€â”€ pagination.decorator.ts
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ logger.ts
â”‚   â”‚       â””â”€â”€ validators.ts
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ config.ts
â”‚   â”‚   â””â”€â”€ jwt.config.ts
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ prisma.service.ts
â”‚   â”‚   â””â”€â”€ schema.prisma
â”‚   â””â”€â”€ main.ts
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ auth.e2e.spec.ts
â”‚   â”œâ”€â”€ orders.e2e.spec.ts
â”‚   â””â”€â”€ products.e2e.spec.ts
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ package.json
```

**Dependencies:**
```json
{
  "@nestjs/common": "^10.0.0",
  "@nestjs/core": "^10.0.0",
  "@nestjs/platform-express": "^10.0.0",
  "@nestjs/jwt": "^11.0.0",
  "@nestjs/passport": "^10.0.0",
  "passport": "^0.7.0",
  "passport-jwt": "^4.0.1",
  "@prisma/client": "^5.7.0",
  "prisma": "^5.7.0",
  "bcrypt": "^5.1.1",
  "class-validator": "^0.14.0",
  "class-transformer": "^0.5.1",
  "helmet": "^7.1.0",
  "dotenv": "^16.3.1",
  "redis": "^4.6.12",
  "@nestjs/throttler": "^5.1.0"
}
```

### Admin Panel (React)

**Estructura:**
```
admin-panel/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Dashboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Dashboard.module.css
â”‚   â”‚   â”œâ”€â”€ Orders/
â”‚   â”‚   â”‚   â”œâ”€â”€ OrdersPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderDetail.tsx
â”‚   â”‚   â”‚   â””â”€â”€ OrdersPage.module.css
â”‚   â”‚   â”œâ”€â”€ Products/
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductsPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductForm.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ProductsPage.module.css
â”‚   â”‚   â”œâ”€â”€ Users/
â”‚   â”‚   â”‚   â”œâ”€â”€ UsersPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ UsersPage.module.css
â”‚   â”‚   â”œâ”€â”€ Reports/
â”‚   â”‚   â”‚   â”œâ”€â”€ ReportsPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ReportsPage.module.css
â”‚   â”‚   â””â”€â”€ Settings/
â”‚   â”‚       â”œâ”€â”€ SettingsPage.tsx
â”‚   â”‚       â””â”€â”€ SettingsPage.module.css
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Layout.tsx
â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚   â”œâ”€â”€ DataTable.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Badge.tsx
â”‚   â”‚   â””â”€â”€ charts/
â”‚   â”‚       â”œâ”€â”€ BarChart.tsx
â”‚   â”‚       â””â”€â”€ PieChart.tsx
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ orders.service.ts
â”‚   â”‚   â”œâ”€â”€ products.service.ts
â”‚   â”‚   â””â”€â”€ users.service.ts
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useFetch.ts
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â””â”€â”€ usePagination.ts
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â””â”€â”€ AuthContext.tsx
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â””â”€â”€ App.tsx
â”œâ”€â”€ public/
â””â”€â”€ package.json
```

**Dependencies:**
```json
{
  "react": "^18.2.0",
  "react-dom": "^18.2.0",
  "@mui/material": "^5.14.0",
  "@mui/icons-material": "^5.14.0",
  "axios": "^1.6.0",
  "recharts": "^2.10.0",
  "zustand": "^4.4.0",
  "@tanstack/react-query": "^5.0.0",
  "react-router-dom": "^6.18.0",
  "date-fns": "^2.30.0"
}
```

### Base de Datos (PostgreSQL + Prisma)

```prisma
// prisma/schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id               String   @id @default(cuid())
  email            String   @unique
  institutionalId  String   @unique
  name             String
  password         String
  department       String?
  role             Role     @default(STUDENT)
  phone            String?
  avatarUrl        String?
  isActive         Boolean  @default(true)
  emailVerified    Boolean  @default(false)
  otpCode          String?
  otpExpiresAt     DateTime?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  orders            Order[]
  notifications    Notification[]
  auditLogs        AuditLog[]

  @@map("users")
}

model Category {
  id              String    @id @default(cuid())
  name            String
  description     String?
  iconUrl         String?
  displayOrder    Int       @default(0)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  products        Product[]

  @@map("categories")
}

model Product {
  id                String    @id @default(cuid())
  categoryId        String
  name              String
  description       String?
  price             Float
  imageUrl          String?
  availableQuantity Int?
  isAvailable       Boolean   @default(true)
  preparationTime   Int?      // en minutos
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  category          Category  @relation(fields: [categoryId], references: [id])
  orderItems        OrderItem[]

  @@map("products")
}

model Order {
  id               String       @id @default(cuid())
  userId           String
  status           OrderStatus  @default(PENDING)
  totalAmount      Float
  paymentMethod    PaymentMethod @default(CASH)
  paymentStatus    PaymentStatus @default(PENDING)
  deliveryLocation String?
  notes            String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  readyAt          DateTime?
  completedAt      DateTime?

  user              User        @relation(fields: [userId], references: [id])
  items             OrderItem[]
  transactions      Transaction[]

  @@map("orders")
}

model OrderItem {
  id          String   @id @default(cuid())
  orderId     String
  productId   String
  quantity    Int
  unitPrice   Float
  subtotal    Float

  order       Order    @relation(fields: [orderId], references: [id])
  product     Product  @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model Transaction {
  id                    String           @id @default(cuid())
  orderId               String
  amount                Float
  currency              String           @default("MXN")
  paymentGateway        PaymentGateway   @default(CASH)
  gatewayTransactionId  String?
  status                TransactionStatus @default(PENDING)
  createdAt             DateTime         @default(now())

  order                 Order            @relation(fields: [orderId], references: [id])

  @@map("transactions")
}

model Notification {
  id        String    @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  body      String
  isRead    Boolean   @default(false)
  createdAt DateTime  @default(now())

  user      User      @relation(fields: [userId], references: [id])

  @@map("notifications")
}

model AuditLog {
  id            String    @id @default(cuid())
  userId        String?
  action        String
  resourceType  String
  resourceId    String?
  changes       Json?
  ipAddress     String?
  createdAt     DateTime  @default(now())

  user          User?     @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

// Enums

enum Role {
  STUDENT
  PROFESSOR
  ADMIN
}

enum OrderStatus {
  PENDING
  ACCEPTED
  PREPARING
  READY
  CANCELLED
}

enum PaymentMethod {
  CARD
  CASH
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

enum PaymentGateway {
  STRIPE
  MERCADO_PAGO
  CASH
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
}

enum NotificationType {
  ORDER_ACCEPTED
  ORDER_PREPARING
  ORDER_READY
  ORDER_CANCELLED
}
```

---

## ğŸ” Seguridad en v1

### AutenticaciÃ³n
- âœ… Password hashing con bcrypt
- âœ… JWT con expiraciÃ³n de 1 hora
- âœ… Refresh tokens vÃ¡lidos 30 dÃ­as
- âœ… OTP de 6 dÃ­gitos para validaciÃ³n de email
- âœ… Rate limiting: 5 intentos de login en 15 minutos

### ValidaciÃ³n Institucional
- âœ… Email debe ser @itsur.edu.mx
- âœ… CÃ³digo institucional debe existir en sistema
- âœ… VerificaciÃ³n de identidad por OTP
- âœ… ConfirmaciÃ³n de email antes de usar la app

### ProtecciÃ³n de Datos
- âœ… ContraseÃ±as nunca almacenadas en texto plano
- âœ… JWT en Storage seguro (EncryptedSharedPreferences en Android)
- âœ… HTTPS obligatorio en todas las conexiones
- âœ… CORS habilitado solo para dominios oficiales

### Roles y Permisos
```typescript
// Guards en backend
@UseGuards(JwtAuthGuard, RolesGuard)
@Roles(Role.ADMIN)
@Get('/admin/dashboard')
getDashboard() { ... }
```

### PrevenciÃ³n de Abuso
- âœ… Rate limiting por IP: 100 requests/minuto
- âœ… ValidaciÃ³n de input en todos los endpoints
- âœ… SQL injection prevention (Prisma ORM)
- âœ… CSRF protection (tokens)

### AuditorÃ­a
```typescript
// Registro de todas las acciones importantes
- CreaciÃ³n de cuenta
- Cambios de perfil
- Cada pedido realizado
- Cambios de admin en productos
- Rechazos de pedidos
```

---

## ğŸ¨ UX/UI en v1

### DiseÃ±o Visual

**Paleta de colores:**
```
Primary (Verde ITSUR): #2D5016
Secondary (Amarillo ITSUR): #FFC107
Success: #4CAF50
Error: #F44336
Warning: #FF9800
```

**TipografÃ­a:**
```
- Headlines: Roboto Bold, 24px
- Body: Roboto Regular, 14px
- Small: Roboto Regular, 12px
```

### Flujos de Usuario Clave

#### Flujo: Primer Pedido (Nuevo Usuario)

```
1. Usuario abre app
   â†“
2. Login/Registro
   â†“
3. Pantalla de bienvenida (tutorial rÃ¡pido)
   â†“
4. Ver menÃº con categorÃ­as
   â†“
5. Seleccionar producto + cantidad
   â†“
6. Ir a carrito
   â†“
7. Seleccionar ubicaciÃ³n de entrega
   â†“
8. Agregar notas (opcional)
   â†“
9. Revisar resumen (subtotal, total)
   â†“
10. Confirmar pedido
    â†“
11. ConfirmaciÃ³n visual + nÃºmero de orden
```

#### Flujo: Rastrear Pedido (Usuario)

```
1. Usuario abre app
   â†“
2. Toca "Mis Pedidos"
   â†“
3. Ve lista de Ãºltimos 5 pedidos
   â†“
4. Toca un pedido activo
   â†“
5. Ve estado actual en tiempo real
   â†“
6. Recibe notificaciÃ³n push cuando cambia estado
   â†“
7. Cuando estÃ¡ "Listo": mapa con ubicaciÃ³n de recogida
```

#### Flujo: Admin Acepta Pedido

```
1. Admin abre panel web
   â†“
2. Ve tabla de pedidos en tiempo real
   â†“
3. Nueva fila aparece: nuevo pedido
   â†“
4. Toca botÃ³n "Aceptar"
   â†“
5. Sistema cambia estado a "ACCEPTED"
   â†“
6. Cliente recibe notificaciÃ³n automÃ¡tica
```

### Animaciones y Transiciones

- **Screen transitions**: Slide/Fade de 300ms
- **Button press**: Ripple effect en Material Design
- **Loading**: Spinner elegante centrado
- **Toast notifications**: Desliza desde arriba (250ms)
- **Order status change**: Fade in del nuevo estado

### Accesibilidad

- âœ… Texto mÃ­nimo 14px (legible sin zoom)
- âœ… Contraste WCAG AA en colores
- âœ… Touch targets mÃ­nimo 48x48dp
- âœ… Compatibilidad con screen readers
- âœ… NavegaciÃ³n por teclado en web

### DiseÃ±o Responsive

**Mobile (v1):**
- iOS 13+ (iPhone 12 y superiores inicialmente)
- Android 10+ (para dispositivos modernos)
- Vertical y horizontal

**Web (Admin):**
- Desktop-first
- Responsive hasta 768px
- Optimizado para tablets tambiÃ©n

---

## ğŸš€ PreparaciÃ³n para ProducciÃ³n en v1

### Play Store
- âœ… Crear cuenta de Google Play Developer ($25 USD)
- âœ… Generar keystore para firma de APK
- âœ… Crear pÃ¡gina de la app (descripciÃ³n, screenshots, polÃ­tica de privacidad)
- âœ… VersiÃ³n mÃ­nima: Android 10 (API 29)
- âœ… Certificados de seguridad actualizados

### Rendimiento

**Targets:**
- TamaÃ±o del APK: < 50MB
- Startup time: < 2 segundos
- API response time: < 500ms
- Cache hit rate: > 80%

**Optimizaciones:**
- Code splitting en backend
- Image optimization
- MinificaciÃ³n de JS/CSS
- Lazy loading de productos
- Redis caching de menÃº (invalidaciÃ³n cada 1 hora)

### Monitoreo

```
ğŸ” MÃ©tricas en ProducciÃ³n:
- API latency (p50, p95, p99)
- Error rate por endpoint
- Database query times
- Cache hit/miss rate
- Crash rate de la app
- Session duration
- Conversion rate (usuarios que completan primer pedido)
```

**Herramientas:**
- Sentry (error tracking)
- Datadog (APM)
- Firebase Analytics (user events)
- CloudWatch (infrastructure)

### Logs

**Estructura de logs:**
```json
{
  "timestamp": "2026-01-20T14:30:00Z",
  "level": "INFO",
  "service": "backend-api",
  "userId": "user_123",
  "action": "order.created",
  "orderId": "order_456",
  "duration_ms": 245,
  "status": "success",
  "metadata": {
    "totalAmount": 45.50,
    "itemCount": 3,
    "paymentMethod": "CASH"
  }
}
```

RetenciÃ³n: 30 dÃ­as en CloudWatch + Datadog

### Backups

**Estrategia:**
- Database: Snapshots diarios automatizados + backup semanal en S3
- CÃ³digo: GitHub con protecciÃ³n de rama main
- ConfiguraciÃ³n: Versionada en repo privado

**Recovery:**
- RTO: 2 horas
- RPO: 1 hora

### SSL/TLS

- âœ… Certificado SSL vÃ¡lido en dominio
- âœ… TLS 1.2 mÃ­nimo
- âœ… RenovaciÃ³n automÃ¡tica con Let's Encrypt o AWS

---

## ğŸ“Š KPIs & Ã‰xito de v1

| KPI | Meta | MÃ©trica |
|-----|------|---------|
| Users Registered | 500 | Registros acumulados |
| Daily Active Users | 100 | Users/dÃ­a |
| Orders/Day | 150 | Pedidos completados |
| Adoption Rate | 25% | (DAU / Estudiantes+Profes) |
| API Uptime | 99.5% | Disponibilidad |
| Avg Order Value | $35 MXN | Ticket promedio |
| Customer Satisfaction | 4.0/5 | NPS Score |

---

## ğŸ”„ Testing en v1

### Unit Tests
- Auth service (login, register, token generation)
- Order creation and validation
- Product filtering logic
- Price calculations

**Coverage target:** 70%

### Integration Tests
- Complete order flow (user registration â†’ order completion)
- Admin accepting orders
- Notifications triggering

### E2E Tests
- Mobile app flows (Detox)
- Admin panel workflows (Cypress)

**Comando de ejecuciÃ³n:**
```bash
# Backend
npm run test
npm run test:e2e

# Mobile
detox test-debug

# Admin
npm run test:e2e
```

---

## ğŸ“… Timeline de v1

| Semana | Hito |
|--------|------|
| 1-2 | Setup inicial, scaffolding backend |
| 3-4 | AutenticaciÃ³n, usuarios, base de datos |
| 5-6 | App mÃ³vil bÃ¡sica, menÃº y productos |
| 7 | Sistema de pedidos, panel admin |
| 8 | Testing, pulido, preparaciÃ³n para beta |

---

## ğŸ“ Entregables de v1

```
âœ… CÃ³digo fuente (GitHub)
   - Backend NestJS completo
   - Mobile app React Native
   - Admin panel React

âœ… DocumentaciÃ³n
   - API documentation (Swagger)
   - Mobile development guide
   - Deployment guide

âœ… Base de datos
   - Schema y migraciones
   - Seed data inicial

âœ… Infraestructura
   - Docker compose para desarrollo
   - AWS deployment guide
   - CI/CD pipeline configuration

âœ… Testing
   - Cobertura de tests
   - Reportes de cobertura

âœ… Release
   - APK generado
   - GuÃ­a de instalaciÃ³n en Play Store
```

---

## ğŸ¯ Criterios de AceptaciÃ³n para v1

- âœ… Usuario puede registrarse con email @itsur.edu.mx
- âœ… Usuario puede hacer login y ver menÃº
- âœ… Usuario puede crear un pedido y enviarlo
- âœ… Admin puede ver pedido en tiempo real y aceptarlo
- âœ… Usuario recibe confirmaciÃ³n cuando pedido es aceptado
- âœ… Sistema registra auditorÃ­a de cada transacciÃ³n
- âœ… API responde en < 500ms en 95% de casos
- âœ… App no crashea bajo uso normal
- âœ… Todos los endpoints tienen rate limiting
- âœ… CÃ³digo tiene cobertura de tests > 70%

---

## ğŸ“Œ Siguiente Fase (v2.0.0)

Luego de v1 completada y validada:

â†’ **v2.0.0 â€” Payments & Notifications**

Con datos reales de uso, v2 agregarÃ¡:
- IntegraciÃ³n de pagos con tarjeta (Stripe/MercadoPago)
- Notificaciones push avanzadas
- Wallet digital interno
- EstadÃ­sticas avanzadas

**Estimado**: 6 semanas despuÃ©s de v1

---

**Documento creado**: 20 Enero 2026
**Estado**: EspecificaciÃ³n TÃ©cnica Completa
**Aprobado por**: Arquitectura de Software
